<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cursor AI Analytics - Informe de Productividad</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* === SISTEMA DE DISEÑO CORPORATIVO === */
        :root {
            --primary-blue: #1B365D;
            --accent-orange: #F4B942;
            --background-gray: #F8F9FA;
            --text-primary: #2C3E50;
            --text-secondary: #6C757D;
            --white: #FFFFFF;
            --border-light: #E9ECEF;
            --success: #27AE60;
            --warning: #F39C12;
            --danger: #E74C3C;
            --info: #3498DB;
            
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-gray);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px;
        }

        /* === NAVEGACIÓN === */
        .nav-menu {
            position: fixed;
            top: 32px;
            right: 32px;
            z-index: 1000;
        }

        .nav-toggle {
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
        }

        .nav-dropdown {
            position: absolute;
            top: 60px;
            right: 0;
            background: var(--white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .nav-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-dropdown a {
            display: block;
            padding: 12px 24px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.875rem;
            border-bottom: 1px solid var(--border-light);
        }

        .nav-dropdown a:hover {
            background: var(--background-gray);
        }

        /* === HEADER === */
        .header {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 48px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-sm);
            text-align: center;
        }

        .header-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 16px;
        }

        .header-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .period-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--primary-blue);
            color: var(--white);
            padding: 12px 24px;
            border-radius: var(--radius-md);
            font-weight: 500;
            flex-wrap: wrap;
        }

        .period-comparison-inline {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
            font-weight: 400;
            margin-left: 8px;
        }

        /* === KPIS === */
        .kpis-section {
            margin-bottom: 48px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* === ICONOS DE AYUDA === */
        .help-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--info);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .help-icon:hover {
            background: var(--primary-blue);
            transform: scale(1.1);
        }

        /* === MODAL DE AYUDA === */
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .help-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .help-modal-content {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 32px;
            max-width: 800px;
            width: 95%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .help-modal.active .help-modal-content {
            transform: scale(1);
        }

        .help-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .help-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .help-modal-close:hover {
            background: var(--background-gray);
            color: var(--text-primary);
        }

        .help-modal-body {
            color: var(--text-primary);
            line-height: 1.6;
        }

        .help-modal-body h4 {
            color: var(--primary-blue);
            margin: 16px 0 8px 0;
            font-weight: 600;
        }

        .help-modal-body ul {
            margin: 12px 0;
            padding-left: 20px;
        }

        .help-modal-body li {
            margin-bottom: 8px;
        }

        .help-example {
            background: var(--background-gray);
            padding: 16px;
            border-radius: var(--radius-md);
            margin: 16px 0;
            border-left: 4px solid var(--info);
        }

        .help-content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-top: 24px;
        }

        .help-content-column {
            min-width: 0; /* Permite que el contenido se ajuste */
        }

        @media (max-width: 768px) {
            .help-content-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
        }

        .kpis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .kpi-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .kpi-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .kpi-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            font-weight: 600;
        }

        .kpi-icon.success { background: rgba(39, 174, 96, 0.1); color: var(--success); }
        .kpi-icon.info { background: rgba(52, 152, 219, 0.1); color: var(--info); }
        .kpi-icon.warning { background: rgba(243, 156, 18, 0.1); color: var(--warning); }
        .kpi-icon.danger { background: rgba(231, 76, 60, 0.1); color: var(--danger); }

        .kpi-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .kpi-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* === INDICADORES COMPARATIVOS === */
        .comparison-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 6px;
            margin-left: 8px;
        }

        .comparison-indicator.positive {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }

        .comparison-indicator.negative {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .comparison-indicator.neutral {
            background: rgba(108, 117, 125, 0.1);
            color: var(--text-secondary);
        }

        /* === BADGES DE COHORTES === */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 6px;
            margin-left: 8px;
        }

        .badge-new {
            background: rgba(52, 152, 219, 0.1);
            color: var(--info);
        }

        .badge-consistent {
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }

        .badge-reactivated {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }



        /* === SECCIONES === */
        .content-section {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 48px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 32px;
        }

        .chart-container {
            position: relative;
            height: 350px;
            margin-bottom: 24px;
        }

        .chart-description {
            background: var(--background-gray);
            padding: 16px;
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            border-left: 3px solid var(--accent-orange);
        }

        /* === TABLAS === */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
        }

        .data-table th {
            background: var(--background-gray);
            padding: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-light);
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.875rem;
        }

        .data-table tr:hover {
            background: rgba(27, 54, 93, 0.02);
        }

        /* === ALINEACIÓN DE COLUMNAS === */
        .data-table th {
            text-align: left; /* Headers por defecto a la izquierda */
        }

        .data-table td {
            text-align: left; /* Datos por defecto a la izquierda */
        }

        /* Alineación a la derecha para números, porcentajes y fechas */
        .data-table th.text-right,
        .data-table td.text-right {
            text-align: right;
        }

        /* Alineación centrada si es necesaria */
        .data-table th.text-center,
        .data-table td.text-center {
            text-align: center;
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .main-container { padding: 24px; }
            .kpis-grid { grid-template-columns: 1fr; }
            .content-grid { grid-template-columns: 1fr; }
            .header-title { font-size: 2rem; }
            /* Cohortes en móvil: 2 filas */
            #cohorts .kpis-grid { grid-template-columns: repeat(2, 1fr) !important; }
        }

        @media (max-width: 1200px) and (min-width: 769px) {
            /* Cohortes en tablet: 3 columnas */
            #cohorts .kpis-grid { grid-template-columns: repeat(3, 1fr) !important; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Navegación -->
        <nav class="nav-menu">
            <button class="nav-toggle" id="navToggle">☰</button>
            <div class="nav-dropdown" id="navDropdown">
                <a href="#kpis">📊 KPIs Principales</a>
                <a href="#evolution">📈 Evolución Temporal</a>
                <a href="#tabs">🔄 Análisis Tabs</a>
                <a href="#teams">👥 Análisis Equipos</a>
                <a href="#technologies">💡 Tecnologías</a>
                <a href="#models">🧠 Modelos IA</a>
                <a href="#cohorts">👥 Cohortes de Usuarios</a>
                <a href="#insights">🔍 Insights Estratégicos</a>
                <a href="#summary">🎯 Resumen Ejecutivo</a>
            </div>
        </nav>

        <!-- Header -->
        <header class="header">
            <h1 class="header-title">🤖 Cursor AI Analytics</h1>
            <p class="header-subtitle">Informe de Productividad y Adopción Comparativo</p>
            <div class="period-badge">
                📅 Período Actual: {{PERIODO_INICIO}} - {{PERIODO_FIN}}
                <span class="period-comparison-inline">vs. {{PERIODO_ANTERIOR_INICIO}} - {{PERIODO_ANTERIOR_FIN}}</span>
            </div>
        </header>

        <!-- KPIs Principales -->
        <section class="kpis-section" id="kpis">
            <h2 class="section-title">
                📊 Indicadores Clave de Rendimiento
                <span class="help-icon" onclick="openHelpModal('kpis-help')" title="Información sobre los KPIs">?</span>
            </h2>
            
            <div class="kpis-grid">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon success">💻</div>
                        <div class="kpi-label">Líneas de Código IA</div>
                    </div>
                    <div class="kpi-value">{{LINEAS_ACEPTADAS}}{{LINEAS_ACEPTADAS_INDICADOR}}</div>
                    <div class="kpi-description">{{LINEAS_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon info">✅</div>
                        <div class="kpi-label">Tasa de Aceptación</div>
                    </div>
                    <div class="kpi-value">{{TASA_ACEPTACION}}%{{TASA_ACEPTACION_INDICADOR}}</div>
                    <div class="kpi-description">{{TASA_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon warning">⚡</div>
                        <div class="kpi-label">Tabs Aceptados</div>
                    </div>
                    <div class="kpi-value">{{TABS_ACEPTADOS}}{{TABS_INDICADOR}}</div>
                    <div class="kpi-description">{{TABS_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon info">📊</div>
                        <div class="kpi-label">Eficiencia Tabs</div>
                    </div>
                    <div class="kpi-value">{{TASA_ACEPTACION_TABS}}%{{TASA_ACEPTACION_TABS_INDICADOR}}</div>
                    <div class="kpi-description">{{EFICIENCIA_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon success">🚀</div>
                        <div class="kpi-label">Peticiones Totales</div>
                    </div>
                    <div class="kpi-value">{{PETICIONES_TOTALES}}{{PETICIONES_INDICADOR}}</div>
                    <div class="kpi-description">{{PETICIONES_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon info">👤</div>
                        <div class="kpi-label">Promedio/Usuario</div>
                    </div>
                    <div class="kpi-value">{{PROMEDIO_LINEAS}}{{PROMEDIO_LINEAS_INDICADOR}}</div>
                    <div class="kpi-description">{{PROMEDIO_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon success">📈</div>
                        <div class="kpi-label">Usuarios Activos</div>
                    </div>
                    <div class="kpi-value">{{USUARIOS_ACTIVOS}}{{USUARIOS_ACTIVOS_INDICADOR}}</div>
                    <div class="kpi-description">{{USUARIOS_TEXTO}} ({{USUARIOS_ACTIVOS}}/{{TOTAL_USUARIOS}} - {{TASA_ADOPCION}}%)</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon danger">⚠️</div>
                        <div class="kpi-label">Usuarios Inactivos</div>
                    </div>
                    <div class="kpi-value">{{USUARIOS_INACTIVOS}}</div>
                    <div class="kpi-description">{{INACTIVOS_TEXTO}}</div>
                </div>
            </div>
        </section>

        <!-- Evolución Temporal - Ancho completo -->
                    <section class="content-section" id="evolution">
                <h2 class="section-title">
                    📈 Evolución Temporal
                    <span class="help-icon" onclick="openHelpModal('evolution-help')" title="Información sobre la evolución temporal">?</span>
                </h2>
            <div class="chart-container">
                <canvas id="evolutionChart"></canvas>
            </div>
            <div class="chart-description">
                Tendencia diaria de líneas aceptadas vs sugeridas y usuarios activos durante el período analizado.
            </div>
        </section>

        <!-- Gráficos Inferiores -->
        <div class="content-grid">
            <section class="content-section" id="tabs">
                <h2 class="section-title">
                    🔄 Evolución de Tabs
                    <span class="help-icon" onclick="openHelpModal('tabs-help')" title="Información sobre la evolución de tabs">?</span>
                </h2>
                <div class="chart-container">
                    <canvas id="tabsChart"></canvas>
                </div>
                <div class="chart-description">
                    Análisis de tabs aceptados vs mostrados en el tiempo.
                </div>
            </section>

            <section class="content-section" id="models">
                <h2 class="section-title">
                    🧠 Modelos de IA
                    <span class="help-icon" onclick="openHelpModal('models-help')" title="Información sobre los modelos de IA">?</span>
                </h2>
                <div class="chart-container">
                    <canvas id="modelsChart"></canvas>
                </div>
                <div class="chart-description">
                    Distribución de uso de modelos de IA por el equipo.
                </div>
            </section>
        </div>

        <!-- Rankings -->
        <div class="content-grid">
            <section class="content-section" id="teams">
                <h2 class="section-title">
                    🏆 Top Productividad
                    <span class="help-icon" onclick="openHelpModal('productivity-help')" title="Información sobre el ranking de productividad">?</span>
                </h2>
                <table class="data-table">
                    <thead>
                        <tr><th>Usuario</th><th class="text-right">Líneas Aceptadas</th></tr>
                    </thead>
                    <tbody>{{TOP_PRODUCTIVIDAD}}</tbody>
                </table>
            </section>

            <section class="content-section">
                <h2 class="section-title">
                    💪 Power Users
                    <span class="help-icon" onclick="openHelpModal('power-users-help')" title="Información sobre los power users">?</span>
                </h2>
                <table class="data-table">
                    <thead>
                        <tr><th>Usuario</th><th class="text-right">Peticiones Totales</th></tr>
                    </thead>
                    <tbody>{{TOP_PETICIONES}}</tbody>
                </table>
            </section>
        </div>

        <div class="content-grid">
            <section class="content-section" id="technologies">
                <h2 class="section-title">
                    💡 Tecnologías
                    <span class="help-icon" onclick="openHelpModal('technologies-help')" title="Información sobre las tecnologías utilizadas">?</span>
                </h2>
                <table class="data-table">
                    <thead>
                        <tr><th>Tecnología</th><th class="text-right">Líneas</th><th class="text-right">Usuarios</th></tr>
                    </thead>
                    <tbody>{{TECNOLOGIAS_UTILIZADAS}}</tbody>
                </table>
            </section>

            <section class="content-section">
                <h2 class="section-title">
                    📱 Versiones Cliente
                    <span class="help-icon" onclick="openHelpModal('versions-help')" title="Información sobre esta métrica">?</span>
                </h2>
                <table class="data-table">
                    <thead>
                        <tr><th>Versión</th><th class="text-right">Usuarios</th><th class="text-right">%</th></tr>
                    </thead>
                    <tbody>{{VERSIONES_CLIENTE}}</tbody>
                </table>
            </section>
        </div>

        <!-- Análisis de Cohortes -->
        <section class="content-section" id="cohorts">
            <h2 class="section-title">
                👥 Análisis de Cohortes de Usuarios
                <span class="help-icon" onclick="openHelpModal('cohorts-help')" title="Información sobre el análisis de cohortes">?</span>
            </h2>
            <div class="kpis-grid" style="grid-template-columns: repeat(5, 1fr); gap: 16px;">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon success">💎</div>
                        <div class="kpi-label">Usuarios Consistentes</div>
                    </div>
                    <div class="kpi-value">{{USUARIOS_CONSISTENTES}}</div>
                    <div class="kpi-description">{{CONSISTENTES_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon info">🌟</div>
                        <div class="kpi-label">Usuarios Nuevos</div>
                    </div>
                    <div class="kpi-value">{{USUARIOS_NUEVOS}}</div>
                    <div class="kpi-description">{{NUEVOS_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon warning">🔄</div>
                        <div class="kpi-label">Usuarios Reactivados</div>
                    </div>
                    <div class="kpi-value">{{USUARIOS_REACTIVADOS}}</div>
                    <div class="kpi-description">{{REACTIVADOS_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon danger">⚠️</div>
                        <div class="kpi-label">Usuarios Perdidos</div>
                    </div>
                    <div class="kpi-value">{{USUARIOS_PERDIDOS}}</div>
                    <div class="kpi-description">{{PERDIDOS_TEXTO}}</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <div class="kpi-icon success">📊</div>
                        <div class="kpi-label">Tasa de Retención</div>
                    </div>
                    <div class="kpi-value">{{TASA_RETENCION}}%</div>
                    <div class="kpi-description">{{RETENCION_TEXTO}}</div>
                </div>
            </div>
        </section>

        <!-- Insights Estratégicos -->
        <section class="content-section" id="insights">
            <h2 class="section-title">🔍 Insights Estratégicos</h2>
            <ul style="list-style: none; padding: 0;">
                {{INSIGHTS_ESTRATEGICOS}}
            </ul>
        </section>

        <!-- Resumen -->
        <section class="content-section" id="summary">
            <h2 class="section-title">🎯 Resumen Ejecutivo</h2>
            <div class="content-grid">
                <div>
                    <h3 style="color: var(--primary-blue); margin-bottom: 16px;">🚀 Adopción Excepcional</h3>
                    <p style="margin-bottom: 24px;">{{TASA_ADOPCION}}% de adopción supera los estándares del sector.</p>
                    <h3 style="color: var(--primary-blue); margin-bottom: 16px;">🔬 Innovación</h3>
                    <p>Diversificación en modelos de IA y experimentación activa.</p>
                </div>
                <div>
                    <h3 style="color: var(--primary-blue); margin-bottom: 16px;">📊 Impacto Mensurable</h3>
                    <p>{{TASA_ACEPTACION}}% de aceptación indica alta calidad. Promedio de {{PROMEDIO_LINEAS}} líneas por usuario.</p>
                </div>
            </div>
        </section>

        <!-- Recomendaciones -->
        <section class="content-section">
            <h2 class="section-title">✅ Recomendaciones</h2>
            <ul style="list-style: none; padding: 0;">
                {{RECOMENDACIONES_ESTRATEGICAS}}
            </ul>
        </section>

        <!-- Usuarios Inactivos -->
        <section class="content-section">
            <h2 class="section-title">⚠️ Usuarios Inactivos</h2>
            <ul style="list-style: none; padding: 0;">
                {{USUARIOS_INACTIVOS_LISTA}}
            </ul>
        </section>

        <!-- Footer -->
        <footer style="text-align: center; padding: 32px; color: var(--text-secondary); font-size: 0.875rem;">
            📊 Informe generado el {{FECHA_GENERACION}} • Cursor AI Analytics v1.0
        </footer>
    </div>

    <!-- Modal de Ayuda - Versiones Cliente -->
    <div id="versions-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">📱 Versiones Cliente - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('versions-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Esta tabla muestra la distribución de versiones del cliente Cursor AI utilizadas por los usuarios durante el período analizado.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>📊 Cómo se calculan los datos:</h4>
                        <ul>
                            <li><strong>Usuarios:</strong> Número total de registros de actividad por versión (usuario × días)</li>
                            <li><strong>Porcentaje:</strong> Proporción de uso de cada versión respecto al total</li>
                            <li><strong>Identificación:</strong> Por combinación de Email + Versión del cliente</li>
                        </ul>

                        <div class="help-example">
                            <h4>💡 Ejemplo práctico:</h4>
                            <p>Si <code>usuario@empresa.com</code> usa la versión <code>1.0.0</code> durante 10 días y luego cambia a <code>1.1.3</code> durante 5 días:</p>
                            <ul>
                                <li>Versión 1.0.0: +10 registros</li>
                                <li>Versión 1.1.3: +5 registros</li>
                            </ul>
                        </div>
                    </div>

                    <div class="help-content-column">
                        <h4>🎯 Utilidad estratégica:</h4>
                        <ul>
                            <li><strong>Fragmentación:</strong> Identificar si hay demasiadas versiones en uso</li>
                            <li><strong>Adopción:</strong> Ver qué tan rápido se adoptan las nuevas versiones</li>
                            <li><strong>Soporte:</strong> Priorizar soporte técnico en versiones más utilizadas</li>
                            <li><strong>Actualizaciones:</strong> Planificar estrategias de migración</li>
                        </ul>

                        <div style="background: rgba(244, 185, 66, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid var(--accent-orange);">
                            <h4 style="color: var(--accent-orange); margin-top: 0;">💡 Recomendación clave:</h4>
                            <p style="margin-bottom: 0;"><em>Una organización saludable debería tener >50% de usuarios en la versión principal para minimizar fragmentación y costes de soporte.</em></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - KPIs -->
    <div id="kpis-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">📊 Indicadores Clave de Rendimiento - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('kpis-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Los KPIs muestran las métricas más importantes del período actual comparadas con el período anterior.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>📈 Métricas principales:</h4>
                        <ul>
                            <li><strong>Líneas de Código IA:</strong> Total de líneas aceptadas (Added + Deleted)</li>
                            <li><strong>Tasa de Aceptación:</strong> % de líneas sugeridas que se aceptaron</li>
                            <li><strong>Usuarios Activos:</strong> Usuarios que utilizaron IA en el período</li>
                            <li><strong>Peticiones Totales:</strong> Suma de todas las interacciones con IA</li>
                        </ul>

                        <h4>🎯 Indicadores comparativos:</h4>
                        <ul>
                            <li><span style="color: var(--success);">📈 +X%</span> Mejora respecto al período anterior</li>
                            <li><span style="color: var(--danger);">📉 -X%</span> Disminución respecto al período anterior</li>
                            <li><span style="color: var(--text-secondary);">➖ X%</span> Sin cambios significativos</li>
                            <li><span style="color: var(--info);">🆕</span> Nuevo (sin período anterior)</li>
                        </ul>
                    </div>

                    <div class="help-content-column">
                        <h4>🔍 Cómo interpretar:</h4>
                        <ul>
                            <li><strong>Eficiencia Tabs:</strong> Ratio de tabs aceptados vs mostrados</li>
                            <li><strong>Promedio/Usuario:</strong> Líneas de código IA por usuario activo</li>
                            <li><strong>Tasa Adopción:</strong> % de usuarios totales que usan IA</li>
                        </ul>

                        <div style="background: rgba(39, 174, 96, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid var(--success);">
                            <h4 style="color: var(--success); margin-top: 0;">✅ Objetivos recomendados:</h4>
                            <ul style="margin-bottom: 0;">
                                <li>Tasa de aceptación >45%</li>
                                <li>Adopción >70%</li>
                                <li>Eficiencia tabs >15%</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - Evolución Temporal -->
    <div id="evolution-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">📈 Evolución Temporal - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('evolution-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Este gráfico muestra la evolución diaria de las métricas principales durante el período de análisis completo.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>📊 Líneas del gráfico:</h4>
                        <ul>
                            <li><strong style="color: var(--primary-blue);">Líneas Aceptadas:</strong> Código IA incorporado cada día</li>
                            <li><strong style="color: var(--accent-orange);">Líneas Sugeridas:</strong> Total de código propuesto por IA</li>
                            <li><strong style="color: var(--success);">Usuarios Activos:</strong> Número de usuarios que usaron IA</li>
                        </ul>

                        <h4>🎯 Tooltips interactivos:</h4>
                        <p>Haz hover sobre cualquier punto para ver:</p>
                        <ul>
                            <li>Valores exactos del día</li>
                            <li>Tasa de aceptación calculada</li>
                            <li>Métricas formateadas en español</li>
                        </ul>
                    </div>

                    <div class="help-content-column">
                        <h4>🔍 Qué buscar:</h4>
                        <ul>
                            <li><strong>Tendencias:</strong> ¿Aumenta el uso de IA?</li>
                            <li><strong>Patrones:</strong> ¿Hay días más productivos?</li>
                            <li><strong>Correlaciones:</strong> ¿Más usuarios = más líneas?</li>
                            <li><strong>Anomalías:</strong> Picos o caídas inusuales</li>
                        </ul>

                        <div class="help-example">
                            <h4>💡 Interpretación:</h4>
                            <p>Una tendencia ascendente en líneas aceptadas con usuarios estables indica mejora en la calidad de las sugerencias de IA.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - Evolución de Tabs -->
    <div id="tabs-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">🔄 Evolución de Tabs - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('tabs-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Este gráfico muestra la evolución de las sugerencias de autocompletado (tabs) de Cursor AI.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>📊 Métricas de tabs:</h4>
                        <ul>
                            <li><strong style="color: var(--info);">Tabs Aceptados:</strong> Autocompletados utilizados por los desarrolladores</li>
                            <li><strong style="color: var(--warning);">Tabs Mostrados:</strong> Total de sugerencias de autocompletado presentadas</li>
                        </ul>

                        <h4>🎯 Eficiencia de tabs:</h4>
                        <p>Se calcula como: <code>(Tabs Aceptados / Tabs Mostrados) × 100</code></p>
                        <ul>
                            <li><strong>>20%:</strong> Excelente eficiencia</li>
                            <li><strong>15-20%:</strong> Buena eficiencia</li>
                            <li><strong><15%:</strong> Necesita mejora</li>
                        </ul>
                    </div>

                    <div class="help-content-column">
                        <h4>🔍 Análisis estratégico:</h4>
                        <ul>
                            <li><strong>Adopción:</strong> ¿Los desarrolladores usan autocompletado?</li>
                            <li><strong>Precisión:</strong> ¿Las sugerencias son relevantes?</li>
                            <li><strong>Productividad:</strong> ¿Acelera el desarrollo?</li>
                        </ul>

                        <div style="background: rgba(52, 152, 219, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid var(--info);">
                            <h4 style="color: var(--info); margin-top: 0;">💡 Optimización:</h4>
                            <p style="margin-bottom: 0;">Una alta ratio de tabs mostrados con baja aceptación puede indicar sugerencias poco relevantes o necesidad de entrenamiento del equipo.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - Modelos de IA -->
    <div id="models-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">🧠 Modelos de IA - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('models-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Este gráfico de donut muestra la distribución de uso de los diferentes modelos de IA disponibles en Cursor.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>🤖 Modelos disponibles:</h4>
                        <ul>
                            <li><strong>GPT-4:</strong> Modelo premium para tareas complejas</li>
                            <li><strong>Claude:</strong> Excelente para análisis y razonamiento</li>
                            <li><strong>GPT-3.5:</strong> Rápido y eficiente para tareas básicas</li>
                            <li><strong>Otros:</strong> Modelos especializados</li>
                        </ul>

                        <h4>📊 Cálculo del uso:</h4>
                        <p>Basado en la columna "Most Used Model" del CSV, que registra el modelo más utilizado por cada usuario en cada día.</p>
                    </div>

                    <div class="help-content-column">
                        <h4>🎯 Análisis estratégico:</h4>
                        <ul>
                            <li><strong>Costes:</strong> Modelos premium vs básicos</li>
                            <li><strong>Preferencias:</strong> ¿Qué modelos prefiere el equipo?</li>
                            <li><strong>Casos de uso:</strong> ¿Se usan los modelos apropiados?</li>
                            <li><strong>Optimización:</strong> Balance coste-beneficio</li>
                        </ul>

                        <div style="background: rgba(243, 156, 18, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid var(--warning);">
                            <h4 style="color: var(--warning); margin-top: 0;">⚡ Recomendación:</h4>
                            <p style="margin-bottom: 0;">Monitorear el uso de modelos premium para optimizar costes sin comprometer la productividad del equipo.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - Top Productividad -->
    <div id="productivity-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">🏆 Top Productividad - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('productivity-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Esta tabla muestra el ranking de usuarios por productividad con IA durante el período analizado.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>📊 Métricas incluidas:</h4>
                        <ul>
                            <li><strong>Total Accepted Lines:</strong> Líneas de código IA aceptadas</li>
                            <li><strong>Total Suggested Lines:</strong> Líneas totales sugeridas por IA</li>
                            <li><strong>Total Requests:</strong> Número de peticiones a la IA</li>
                            <li><strong>Acceptance Rate:</strong> % de líneas sugeridas que se aceptaron</li>
                        </ul>

                        <h4>🎯 Ordenación:</h4>
                        <p>Los usuarios están ordenados por <strong>Total Accepted Lines</strong> (líneas aceptadas) de mayor a menor.</p>
                    </div>

                    <div class="help-content-column">
                        <h4>🔍 Análisis estratégico:</h4>
                        <ul>
                            <li><strong>Power Users:</strong> Identificar usuarios más productivos</li>
                            <li><strong>Adopción:</strong> Ver quién aprovecha mejor la IA</li>
                            <li><strong>Eficiencia:</strong> Comparar tasas de aceptación</li>
                            <li><strong>Formación:</strong> Detectar necesidades de training</li>
                        </ul>

                        <div style="background: rgba(39, 174, 96, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid var(--success);">
                            <h4 style="color: var(--success); margin-top: 0;">💡 Insight clave:</h4>
                            <p style="margin-bottom: 0;">Los usuarios con alta tasa de aceptación (>50%) son candidatos ideales para ser mentores internos de IA.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - Power Users -->
    <div id="power-users-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">💪 Power Users - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('power-users-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Esta tabla identifica a los usuarios más avanzados en el uso de IA, con métricas de alto rendimiento.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>🏅 Criterios Power User:</h4>
                        <ul>
                            <li><strong>Líneas Aceptadas:</strong> >1000 líneas en el período</li>
                            <li><strong>Tasa Aceptación:</strong> >40% de eficiencia</li>
                            <li><strong>Uso Consistente:</strong> Actividad regular</li>
                            <li><strong>Diversidad:</strong> Uso de múltiples funciones</li>
                        </ul>

                        <h4>📈 Métricas mostradas:</h4>
                        <ul>
                            <li>Total de líneas aceptadas</li>
                            <li>Tasa de aceptación</li>
                            <li>Días activos en el período</li>
                            <li>Promedio líneas/día</li>
                        </ul>
                    </div>

                    <div class="help-content-column">
                        <h4>🎯 Valor estratégico:</h4>
                        <ul>
                            <li><strong>Mentores:</strong> Pueden formar a otros desarrolladores</li>
                            <li><strong>Beta Testers:</strong> Ideales para nuevas funciones</li>
                            <li><strong>Feedback:</strong> Sus opiniones son muy valiosas</li>
                            <li><strong>Casos de éxito:</strong> Ejemplos de buenas prácticas</li>
                        </ul>

                        <div style="background: rgba(155, 89, 182, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid #9B59B6;">
                            <h4 style="color: #9B59B6; margin-top: 0;">🚀 Programa Power Users:</h4>
                            <p style="margin-bottom: 0;">Considera crear un programa especial para estos usuarios: acceso anticipado, feedback directo, reconocimiento interno.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - Tecnologías -->
    <div id="technologies-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">💡 Tecnologías - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('technologies-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>Esta tabla muestra las tecnologías y lenguajes de programación más utilizados con IA en el período.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>🔧 Datos de tecnologías:</h4>
                        <ul>
                            <li><strong>Lenguaje/Tecnología:</strong> Identificado por extensiones de archivo</li>
                            <li><strong>Líneas Aceptadas:</strong> Código IA incorporado por tecnología</li>
                            <li><strong>Usuarios:</strong> Número de desarrolladores que la usan</li>
                            <li><strong>% del Total:</strong> Proporción respecto al total</li>
                        </ul>

                        <h4>📊 Ordenación:</h4>
                        <p>Las tecnologías están ordenadas por <strong>líneas aceptadas</strong> de mayor a menor.</p>
                    </div>

                    <div class="help-content-column">
                        <h4>🎯 Análisis estratégico:</h4>
                        <ul>
                            <li><strong>Stack Tecnológico:</strong> ¿Qué tecnologías domina el equipo?</li>
                            <li><strong>Adopción IA:</strong> ¿Dónde funciona mejor la IA?</li>
                            <li><strong>Especialización:</strong> Identificar expertos por tecnología</li>
                            <li><strong>Formación:</strong> Detectar gaps tecnológicos</li>
                        </ul>

                        <div style="background: rgba(52, 152, 219, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid var(--info);">
                            <h4 style="color: var(--info); margin-top: 0;">📈 Insight:</h4>
                            <p style="margin-bottom: 0;">Las tecnologías con más líneas IA aceptadas suelen ser aquellas donde la IA ofrece mejor soporte y sugerencias más precisas.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Ayuda - Análisis de Cohortes -->
    <div id="cohorts-help" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3 class="help-modal-title">👥 Análisis de Cohortes - Información Detallada</h3>
                <button class="help-modal-close" onclick="closeHelpModal('cohorts-help')">&times;</button>
            </div>
            <div class="help-modal-body">
                <p><strong>El análisis de cohortes segmenta a los usuarios según su nivel de actividad y compromiso con la IA.</strong></p>
                
                <div class="help-content-grid">
                    <div class="help-content-column">
                        <h4>🏷️ Definición de cohortes:</h4>
                        <ul>
                            <li><strong>🔥 Heavy Users:</strong> >2000 líneas aceptadas</li>
                            <li><strong>⚡ Active Users:</strong> 500-2000 líneas aceptadas</li>
                            <li><strong>🌱 Light Users:</strong> 100-500 líneas aceptadas</li>
                            <li><strong>👀 Explorers:</strong> 1-100 líneas aceptadas</li>
                            <li><strong>😴 Inactive:</strong> 0 líneas aceptadas</li>
                        </ul>

                        <h4>📊 Métricas por cohorte:</h4>
                        <ul>
                            <li>Número de usuarios</li>
                            <li>% del total de usuarios</li>
                            <li>Promedio líneas/usuario</li>
                        </ul>
                    </div>

                    <div class="help-content-column">
                        <h4>🎯 Estrategias por cohorte:</h4>
                        <ul>
                            <li><strong>Heavy Users:</strong> Programas de reconocimiento, beta testing</li>
                            <li><strong>Active Users:</strong> Formación avanzada, casos de uso complejos</li>
                            <li><strong>Light Users:</strong> Tutoriales, mejores prácticas</li>
                            <li><strong>Explorers:</strong> Onboarding, formación básica</li>
                            <li><strong>Inactive:</strong> Campañas de activación, demos</li>
                        </ul>

                        <div style="background: rgba(231, 76, 60, 0.1); padding: 16px; border-radius: var(--radius-md); margin-top: 16px; border-left: 4px solid var(--danger);">
                            <h4 style="color: var(--danger); margin-top: 0;">⚠️ Objetivo:</h4>
                            <p style="margin-bottom: 0;">Reducir usuarios inactivos y mover usuarios hacia cohortes más activas mediante formación y soporte dirigido.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuración corporativa
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#6C757D';

        const colors = {
            primary: '#1B365D',
            accent: '#F4B942',
            success: '#27AE60',
            info: '#3498DB',
            warning: '#F39C12'
        };

        // Gráfico Evolución con tooltips interactivos
        new Chart(document.getElementById('evolutionChart'), {
            type: 'line',
            data: {
                labels: {{CHART_EVOLUTION_LABELS}},
                datasets: [{
                    label: 'Total Accepted Lines',
                    data: {{CHART_EVOLUTION_ACCEPTED}},
                    borderColor: colors.primary,
                    backgroundColor: colors.primary + '20',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.3
                }, {
                    label: 'Total Suggested Lines',
                    data: {{CHART_EVOLUTION_SUGGESTED}},
                    borderColor: colors.accent,
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.3
                }, {
                    label: 'Usuarios Activos',
                    data: {{CHART_EVOLUTION_USERS}},
                    borderColor: colors.success,
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    yAxisID: 'y1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        titleColor: '#1B365D',
                        bodyColor: '#1B365D',
                        borderColor: '#1B365D',
                        borderWidth: 1,
                        cornerRadius: 8,
                        displayColors: true,
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont: { size: 13 },
                        padding: 12,
                        callbacks: {
                            title: function(context) {
                                return context[0].label;
                            },
                            label: function(context) {
                                const value = context.parsed.y;
                                const formattedValue = new Intl.NumberFormat('es-ES').format(value);
                                
                                if (context.dataset.label === 'Total Accepted Lines') {
                                    return `📈 Total Accepted Lines: ${formattedValue}`;
                                } else if (context.dataset.label === 'Total Suggested Lines') {
                                    return `💡 Total Suggested Lines: ${formattedValue}`;
                                } else if (context.dataset.label === 'Usuarios Activos') {
                                    return `👥 Usuarios Activos: ${formattedValue}`;
                                }
                                return `${context.dataset.label}: ${formattedValue}`;
                            },
                            afterBody: function(context) {
                                // Calcular tasa de aceptación para este punto
                                const accepted = context.find(c => c.dataset.label === 'Total Accepted Lines')?.parsed.y || 0;
                                const suggested = context.find(c => c.dataset.label === 'Total Suggested Lines')?.parsed.y || 0;
                                const acceptanceRate = suggested > 0 ? ((accepted / suggested) * 100).toFixed(1) : '0.0';
                                return [``, `✅ Tasa de Aceptación: ${acceptanceRate}%`];
                            }
                        }
                    }
                },
                scales: {
                    y: { 
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Líneas de Código'
                        }
                    },
                    y1: { 
                        type: 'linear', 
                        position: 'right', 
                        beginAtZero: true, 
                        grid: { drawOnChartArea: false },
                        title: {
                            display: true,
                            text: 'Usuarios'
                        }
                    }
                }
            }
        });

        // Gráfico Modelos
        new Chart(document.getElementById('modelsChart'), {
            type: 'doughnut',
            data: {
                labels: {{CHART_MODELS_LABELS}},
                datasets: [{
                    data: {{CHART_MODELS_DATA}},
                    backgroundColor: [colors.primary, colors.accent, colors.success, colors.info, colors.warning, '#E74C3C']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Gráfico Tabs con tooltips interactivos
        new Chart(document.getElementById('tabsChart'), {
            type: 'line',
            data: {
                labels: {{CHART_EVOLUTION_LABELS}},
                datasets: [{
                    label: 'Tabs Aceptados',
                    data: {{CHART_TABS_ACCEPTED}},
                    borderColor: colors.info,
                    backgroundColor: colors.info + '20',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.3
                }, {
                    label: 'Tabs Mostrados',
                    data: {{CHART_TABS_SHOWN}},
                    borderColor: colors.warning,
                    borderWidth: 2,
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        titleColor: '#1B365D',
                        bodyColor: '#1B365D',
                        borderColor: '#1B365D',
                        borderWidth: 1,
                        cornerRadius: 8,
                        displayColors: true,
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont: { size: 13 },
                        padding: 12,
                        callbacks: {
                            title: function(context) {
                                return context[0].label;
                            },
                            label: function(context) {
                                const value = context.parsed.y;
                                const formattedValue = new Intl.NumberFormat('es-ES').format(value);
                                
                                if (context.dataset.label === 'Tabs Aceptados') {
                                    return `⚡ Tabs Aceptados: ${formattedValue}`;
                                } else if (context.dataset.label === 'Tabs Mostrados') {
                                    return `💡 Tabs Mostrados: ${formattedValue}`;
                                }
                                return `${context.dataset.label}: ${formattedValue}`;
                            },
                            afterBody: function(context) {
                                // Calcular eficiencia de tabs para este punto
                                const accepted = context.find(c => c.dataset.label === 'Tabs Aceptados')?.parsed.y || 0;
                                const shown = context.find(c => c.dataset.label === 'Tabs Mostrados')?.parsed.y || 0;
                                const efficiency = shown > 0 ? ((accepted / shown) * 100).toFixed(1) : '0.0';
                                return [``, `📊 Eficiencia Tabs: ${efficiency}%`];
                            }
                        }
                    }
                },
                scales: { 
                    y: { 
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Número de Tabs'
                        }
                    } 
                }
            }
        });

        // Navegación
        const navToggle = document.getElementById('navToggle');
        const navDropdown = document.getElementById('navDropdown');

        navToggle.addEventListener('click', () => {
            navDropdown.classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
            if (!navToggle.contains(e.target) && !navDropdown.contains(e.target)) {
                navDropdown.classList.remove('active');
            }
        });

        // Control de visibilidad de comparación de períodos
        document.addEventListener('DOMContentLoaded', () => {
            const comparativaValida = '{{COMPARATIVA_VALIDA}}' === 'true';
            const periodComparison = document.getElementById('periodComparison');
            
            if (periodComparison) {
                periodComparison.style.display = comparativaValida ? 'flex' : 'none';
            }
        });

        // === FUNCIONES DE AYUDA ===
        function openHelpModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevenir scroll del body
            }
        }

        function closeHelpModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto'; // Restaurar scroll del body
            }
        }

        // Cerrar modal al hacer clic fuera del contenido
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('help-modal')) {
                event.target.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const activeModal = document.querySelector('.help-modal.active');
                if (activeModal) {
                    activeModal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            }
        });
    </script>
</body>
</html> 